clc
clear
format long
optimization=1;
Rg=8.31446;
MW=32.04; % Molar mass of the solvent
Tc=[512.6 304.1282]; %%% %solvent,solute (Gas)
Pc=[8.1035*1e6 7.3773E6];  %solvent,solute (Gas)
w=0;
par=[
  -0.030781447746978
  -0.005167686781374
   0.039350171087409
]
data=[
298.15	1.73	4.312558312
298.15	1.75	4.491354464
298.15	2.38	6.497103943
298.15	3.02	9.264939381
298.15	3.61	12.08949413
298.15	4.11	15.53303989
298.15	4.43	17.8783284
298.15	4.85	22.60105902
298.15	5.14	28.0016608
298.15	5.29	30.67873467
298.15	5.53	38.98916278
298.15	5.72	52.8703345
298.15	5.75	58.94206476
298.15	5.92	132.7984003
298.15	5.94	133.8391791
298.15	6.04	414.0241959
298.15	6.23	985.4335175
323.15	0.99	1.344543374
323.15	1.96	3.261055115
323.15	2.52	4.24395667
323.15	3.42	6.087037475
323.15	4.75	9.683911882
323.15	5.98	13.66462303
323.15	7.1	23.97109695
323.15	8.81	38.59663231
323.15	9.19	54.95959978
323.15	9.28	60.07589957
323.15	9.32	71.12011625
323.15	9.5	84.08634017
323.15	9.53	139.5274506
323.15	9.55	164.3465718
373.15	2.01	1.27338745
373.15	3.81	3.011586394
373.15	4.84	4.195691291
373.15	5.84	5.271756301
373.15	8.37	9.123707797
373.15	9.07	10.16094675
373.15	11.74	16.28709054
373.15	12.71	20.53136497
373.15	14.75	33.60933828
373.15	15.41	50.8583965
373.15	15.42	62.34712604
423.15	3.67	1.504932252
423.15	5.89	3.24583231
423.15	6.95	4.223830112
423.15	10.45	7.964344807
423.15	11.62	9.780590128
423.15	12.8	11.82677748
423.15	14.8	17.02110501
423.15	15.13	18.75057331
423.15	15.97	24.05904431
423.15	16.08	28.23851138
423.15	16.13	33.51523992
473.15	7.52	2.284384271
473.15	10.4	5.009260068
473.15	12.8	9.83449804
473.15	12.93	11.54378944



];

n1=size(data);
np=n1(1);
nt=n1(1);
T=data(:,1)';
P=data(:,2)'*1E6;
mola=data(:,3)';

% for i=1:np
%     for j=3:n1(2)
%         mola(i,j-2)=data(i,j);
%     end
% end
if optimization==1
    ParFinal=fminsearch(@ (par) objective(par,np,P,T,Tc,Pc,Rg,mola,MW),par);
    [Pcal Ycal PHIL PHIG VL VG ]=pressure(ParFinal,np,P,T,Tc,Pc,Rg,mola,MW);
end
if optimization==0
    [Pcal Ycal PHIL PHIG VL VG ]=pressure(par,np,P,T,Tc,Pc,Rg,mola,MW);
end

    AADP=0;
    for j=1:np
        AADP0(j)=(abs((Pcal(j)-P(j))./P(j)))*100;
        AADP=AADP0(j)+AADP;
    end

[Leftt Rightt DelttaA]=consistency(par,np,P,T,Tc,Pc,Rg,mola,MW);

results=[T' P' mola' Pcal' AADP0'];

[Rightt' Leftt'  DelttaA'];

for i=1:nt
    hold on
    plot(mola,Pcal,'-',mola,P,'^')
end
